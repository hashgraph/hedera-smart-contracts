---
status: "proposed"
date: "2025-10-07"
decision-makers: Fernano Paris <fernando.paris@swirldslabs.com>, Mariusz Jasuwienas <mariusz.jasuwienas@arianelabs.com>, Michal Walczak <michal.walczak@arianelabs.com>, Piotr Swierzy <piotr.swierzy@arianelabs.com>
consulted:
informed:
supersedes: ADR-001
---

# ADR 004: Include Tests and Examples in System Contracts Repository

## Context and Problem Statement

The new Hedera System Contracts repository will be published as an NPM package for developers to use. We need to decide whether to include tests and examples in the repository, and if so, how to handle them in the published package.

The key tension is between:
- Maintaining high code quality through comprehensive tests
- Providing executable documentation and usage examples
- Keeping the published NPM package lean and focused

## Decision Drivers

- Quality and reliability of the library (tests as a verification mechanism)
- Developer experience and ability to understand contract usage
- NPM package size and cleanliness
- Repository maintainability
- Providing reference implementations and usage patterns

## Considered Options

### Option 1: Remove Tests and Examples from the R``epository (Recommended)

The repository contains only production-ready smart contracts, with no tests or examples included.

**Pros:**
- Clean, focused repository containing only production code
- Minimal maintenance overhead
- Clear purpose - no ambiguity about what's production-ready
- Smaller repository size and faster clones
- NPM package contains exactly what's in the repository
- Simpler CI/CD (no test execution in this repo)
- Forces clear separation between library and examples
- Similar approach to some mature libraries that rely on community validation

**Cons:**
- Contributors cannot run tests directly in the repository
- Higher barrier for external contributions (harder to validate changes)
- Need to maintain testing infrastructure elsewhere
- Less confidence for contributors that changes don't break functionality
- Examples are not co-located with contracts
- Need clear documentation about where to find tests and examples
- Potential quality concerns without built-in validation

### Option 2: Keep Tests and Examples in Repository, Exclude from NPM Package

The repository contains tests and examples, but they are excluded from the published NPM package via `.npmignore`.

**Pros:**
- High code quality maintained through comprehensive tests
- Better developer experience with clear, executable examples
- Executable documentation helps users understand contract usage
- Contributors can validate their changes before submitting PRs
- Clean NPM package without test code or build artifacts
- Lower barrier to entry for new contributors
- Tests serve as both verification and documentation
- All related code in one place

**Cons:**
- Repository is larger due to test code
- Need to maintain tests alongside production code
- Must ensure `.npmignore` is properly configured
- More complex CI/CD pipeline
- Increased maintenance burden
- Risk of tests becoming outdated
- Need to support testing frameworks (see ADR-005)

### Option 3: Include Tests and Examples in the NPM Package

Both tests and examples are included in the published NPM package.

**Pros:**
- Users can run tests locally to verify installation
- Examples immediately available after installation
- Complete transparency - users see everything
- Can serve as reference implementation within node_modules
- No configuration needed for `.npmignore`

**Cons:**
- Significantly larger NPM package size
- Users install unnecessary code (tests, dev dependencies)
- Slower installation times
- Pollutes node_modules with non-production code
- Confusion about what's meant for production use
- May include development dependencies in user projects
- Non-standard approach in the ecosystem
- Potential security concerns (exposing test infrastructure)

## Decision Outcome

**Chosen option:** Remove tests and examples from the repository.

### Rationale

The new System Contracts repository will be a lean, production-focused package similar to OpenZeppelin Contracts' approach:

1. **Simplicity and clarity**: The repository focuses solely on production-ready smart contracts that developers need to integrate
2. **Minimal surface area**: Reduces maintenance burden and keeps the repository clean and focused
3. **Separate concerns**: Testing and examples can live in a separate repository or documentation site
4. **Package consistency**: What's in the repository is exactly what's in the NPM package - no confusion
5. **CI/CD efficiency**: Testing can be handled in downstream integration projects or separate test repositories
6. **Trust through adoption**: Production usage and community adoption validate the contracts

### Alternative Testing Strategy

Instead of maintaining tests in the repository, quality assurance will be achieved through:

- **Separate test repository**: Create a dedicated repository for integration tests and examples
- **Downstream validation**: The current `hedera-smart-contracts` repository can serve as the testing ground
- **Community testing**: Users' production implementations serve as validation
- **Formal verification**: Consider formal verification for critical contracts
- **Pre-release validation**: Thorough testing before tagging releases

## Implementation Strategy

### Repository Structure

The repository will contain only:
- Production smart contracts organized by service (per ADR-003)
- Essential interfaces and helper utilities
- README with usage documentation
- LICENSE and basic repository metadata
- Package configuration (`package.json`, `.gitignore`)

### Documentation Approach

- **README**: Include clear usage examples and integration patterns
- **Inline documentation**: Comprehensive NatSpec comments in contracts
- **External examples**: Link to example implementations in other repositories
- **Integration guides**: Documentation on how to use contracts with Hardhat/Foundry

## Consequences

### Positive

- Clean, focused repository containing only production code
- Minimal maintenance overhead
- Clear purpose - no ambiguity about what's production-ready
- Smaller repository size and faster clones
- NPM package contains exactly what's in the repository
- Simpler CI/CD (no test execution in this repo)
- Forces clear separation between library and examples

### Negative

- Contributors cannot run tests directly in the repository
- Higher barrier for external contributions (harder to validate changes)
- Need to maintain testing infrastructure elsewhere
- Less confidence for contributors that changes don't break functionality
- Examples are not co-located with contracts
- Need clear documentation about where to find tests and examples

## Implementation Notes

- Create a separate repository for tests, examples, and integration scenarios
- Link to the test repository prominently in the README
- Consider using the existing `hedera-smart-contracts` repository as the test/examples location
- Ensure comprehensive inline documentation to compensate for lack of examples
- ADR-005 (Testing Framework Selection) may become less relevant or apply to the separate test repository
