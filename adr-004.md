---
status: "proposed"
date: "2025-10-06"
decision-makers: Fernano Paris <fernando.paris@swirldslabs.com>, Mariusz Jasuwienas <mariusz.jasuwienas@arianelabs.com>, Michal Walczak <michal.walczak@arianelabs.com>, Piotr Swierzy <piotr.swierzy@arianelabs.com>
consulted:
informed:
---

# ADR 004: Testing Framework Selection for System Contracts Repository

## Context and Problem Statement

The Hedera System Contracts will require testing infrastructure (in a separate repository per ADR-004). We need to choose which smart contract testing framework(s) to support for development, validation, and example implementations.

The two most popular testing frameworks in the Ethereum ecosystem are:
- **Hardhat**: JavaScript/TypeScript-based, widely adopted, extensive plugin ecosystem
- **Foundry**: Solidity-based, fast execution, growing adoption

We need to decide whether to support one framework or both.

## Decision Drivers

- Developer adoption and community preferences
- Ease of onboarding for new users
- Testing speed and developer experience
- Maintenance overhead for the project
- Support for the latest features and tooling

## Considered Options

1. **Support Only Hardhat** (recommended)
2. Support Only Foundry
3. Support Both Hardhat and Foundry

## Option 1: Support Only Hardhat

Support Hardhat as the single testing framework for the System Contracts repository.

### Positive

- **Market dominance**: Hardhat is the most widely adopted testing framework in the Ethereum ecosystem
- **Simpler maintenance**: Single framework means less complexity and maintenance overhead
- **JavaScript/TypeScript ecosystem**: Leverages familiar tools for most developers
- **Extensive plugin ecosystem**: Rich set of plugins for various needs
- **Better documentation**: More tutorials, guides, and community resources available
- **Easier onboarding**: Most developers already know Hardhat
- **Consistent tooling**: Single set of commands and workflows
- **Lower CI/CD complexity**: Only one framework to test against
- **Industry standard**: Used by major projects like OpenZeppelin, Uniswap, Aave

### Negative

- **Slower test execution**: JavaScript-based tests are slower than Foundry's Solidity tests
- **Excludes Foundry users**: Developers who prefer Foundry may have friction
- **Less modern**: Foundry is considered more modern by some in the community
- **No Solidity testing**: Cannot write tests in Solidity
- **Heavier dependencies**: Requires Node.js ecosystem

## Option 2: Support Only Foundry

Support Foundry as the single testing framework for the System Contracts repository.

## Consequences

### Positive

- **Fast execution**: Significantly faster test runs due to Rust-based implementation
- **Solidity-native testing**: Write tests in Solidity, keeping everything in one language
- **Modern tooling**: Built from the ground up with modern practices
- **Growing adoption**: Rapidly gaining popularity, especially among new projects
- **Built-in fuzzing**: Excellent property-based testing capabilities
- **Better gas reporting**: More detailed and accurate gas usage reporting
- **Lightweight**: No Node.js dependencies required

### Negative
- **Would require implementation**: we currently have example usages of the smart contract written in Solidity, but they would need to be rewritten as Foundry test files.
- **Smaller user base**: Less adoption compared to Hardhat
- **Fewer resources**: Less documentation, tutorials, and community support
- **Learning curve**: Developers familiar with Hardhat need to learn new tooling
- **Plugin ecosystem**: Smaller ecosystem compared to Hardhat
- **Less mature**: Newer framework with potentially more breaking changes
- **Limited JavaScript integration**: Harder to integrate with JavaScript-based tools
- **Compatibility concerns**: Some developers may not have Rust toolchain installed

### Option 3: Support Both Hardhat and Foundry

Support both frameworks in parallel, allowing users to choose their preference.

## Consequences

### Positive

- **Maximum flexibility**: Developers can use their preferred framework
- **Broader adoption**: Attracts users from both communities
- **Cross-validation**: Both frameworks validate the contracts
- **Future-proof**: Hedges against framework popularity shifts
- **Best of both worlds**: Fast Foundry tests + comprehensive Hardhat ecosystem

### Negative

- **Double maintenance burden**: Need to maintain configurations and tests for both
- **Complex CI/CD**: Must run tests in both frameworks, doubling pipeline time
- **Potential inconsistencies**: Tests may behave differently across frameworks
- **Documentation overhead**: Need to document both frameworks thoroughly
- **Increased complexity**: More moving parts to manage
- **Risk of drift**: Tests in one framework may not be updated in the other
- **Higher barrier for contributors**: Contributors need to understand both frameworks
- **Version management**: Need to keep both frameworks updated

## Decision Outcome

**Chosen option:** Support only Hardhat (Option 1).

### Rationale

Hardhat provides the best balance of adoption, ecosystem support, and simplicity:

1. **We already have tests implemented**: reviewing them should be sufficient
2. **Industry standard**: Hardhat is the de facto standard in the Ethereum ecosystem, used by the majority of projects
3. **Target audience alignment**: Most Hedera developers building smart contracts are already familiar with Hardhat
4. **Simplified maintenance**: Supporting a single framework reduces complexity and maintenance overhead
5. **Existing patterns**: The current `hedera-smart-contracts` repository already uses Hardhat extensively
6. **Plugin ecosystem**: Hardhat's extensive plugin ecosystem provides solutions for most needs
7. **Practical choice**: Given that tests will be in a separate repository (per ADR-004), a single framework is sufficient
8. **OpenZeppelin alignment**: Following the same tooling as OpenZeppelin Contracts

## Consequences

### Positive

- Clear, single framework for all development and testing
- Lower maintenance overhead
- Easier onboarding for contributors
- Consistent with most existing Hedera smart contract projects
- Leverages extensive Hardhat ecosystem and community support
- Simpler CI/CD pipeline
- Better documentation availability

### Negative

- Developers who prefer Foundry may face friction
- Slower test execution compared to Foundry
- Cannot leverage Foundry's modern features (fuzzing, gas reporting)
- May need to reconsider if Foundry becomes the dominant framework
- Limited to JavaScript/TypeScript for testing


## Decision Outcome

**Chosen option:** Support only Hardhat (Option 1).
